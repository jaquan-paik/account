language: python
python:
- '3.6'

services:
- docker
- mysql

addons:
  mariadb: '10.2'

env:
  global:
  - secure: m60wLQKswtwoB31n21Zcqg0+VTICfSnjowLeB4B5Dwi+Fnx4qYPzyvl0Elus1EDGSMRij/UHVS4PjfwXyXpqdfBGC5RjLJFgbEuCCZFNeKGNbJf5tY4zFJXpeReT8cAATnsdAHxMsWb0WowYq8UDPX58jQehcoqRPnv2gzUcm0EHLGrPe/W4vpS0B8BlFiEnxkgCikQgOK5wbVWF6HsEYwYs9IK3KPiIIy2IL/tJOUJ/PnDtWpxAcdmLjkHlFL7sDJFldNkgVq75i7PL4cPLs7NMBNGbwn7gMffmrr8gt/hZIGGvyuAM50iji2TjzqngF8DofxGY0xmA34/z5Ak7lw9EIiNqOZxGCz5M46OjlNdxgIBS4wOL81HiMvcQD9RRDkmxwdrEjDVRgTENejMtGgDeoLf3FMCXQ7DIPZBmbRWJj49ff8Z6lEzmXTcDuz2DDznR0Ij4o8i/A8obndWofUQCY+ZgKjG7J6l/66Q4Sn8P3NkSfQpcI0TOmWJ3wc/mbBBoQSMn1ViECXbcsFJi7tPuPrrJi/457o9U0MiQmNdYkh8Lv/e2MrVdVqFTnYLeqQ1hAq8rxYMoPQMjlGZCQ+k2yuR6WqOx7hbhch9dr9l+P+KDlsqQzipu6O19K57Vai+Zf/K0v5Ld1/mWy0xZBSXBR4pW2aRxe5XDzNH7yGM=
  - secure: hViLtrWbEPLPg8UnvKKwXOxCv2SwYe9ElRowGPOvYfkbKPP6yTbqRnFqg13OPAN4jTB6lH0Ukg+lvz3MBSu8fxO7ye3iwyp5804Uhr5ho/loIBIfTs/TsfxxaCN8+OIfAHeRb5inOPCvoBwtp9IZ1u5N3sYfqCLbLo1cyABlPy02KsAnv6IHZ9wsGn/wHgU5hV3eAjRAhZlHzSsYxbKgxjJX/oEDA+PEqfoo/pXzef6tFAJbahORz/cpvg76yPXz1z5DL4Vmc+/AMzPzJTT5UaVsrmptHv/6QcMR2tbUGh1/ztRujp6IJZ1f+YlSLkzbB639k55ZzLjpzmUkzug2lefxopOpgreITucYXZgDlamumvXubeu+0K99m0tro9okWJ40DWd7vQxxhiWihChgsUloV9f0cl3FEcESTUyCRd1JBA563Xhd3z0x7xwpCm2CvekgdkyTjR0ekLEj0c9+C1w1mDPcKCZkUEdssFFhV3yej7Wm2Jh1ptmi64xWxwDTMUaiHt5IAdA2bK21jsZBgSVh5ImCqjlZSinhwMBig8sO4IhpyJSaEyXU3RboyYwkUJcKrTRXxPlFmyRsodVyycoGm/q6vNXmGTSBXEH5/51GUbXDpJKFYMyaeaba57iHm9+Ckd4DPavrapjy7BRov8oBZwb+Ts9G2TyOLKPFG/A=

  # Development Setting
  - secure: 2NLIzqg5hCGw5J8yPLDGB0u1nfmGBN0WSkg1cnkniaUblHZ1TFs86Ou69dk86l75Yoof/nlUju3vEFBnXoBUVQIyHMh0WwyKnglY2w55wRlVDcBDDFnVAg8d0aOezGs3ghUx+4TYnTRxNzSc32AEBbodlkUYeXiUEgQyr/63DhO8LrheDjtWALSDmtM4FQkWL6llo0E5NON6So5BxZBeY04dh+mwvX5+OBC6En1+6f6dCgjWKGJVTk0QOxA9I/OlgfOm/FNQi9fzKkYQlathSgPipzAlLFJ+a8/r9DRZaHd5i2HEWRmkLVJebS1ot2ly5yQ2K+jy9drVC3kEjE/jDvsx0WhcxSRqaw36PIeMpQIj9gxFNNMRHDV96rh/uE4shsjVhHbjs31RRjwFCMtW87WlHF9vp4u1d3N2H7PaXj1rxaQWGMAhld0+dHsw0a2LERSBrFCL5X3Nh28LdypBwzHYm6QZ0/fpxWGjywVpBdBfzP+V05qLyYSPOvoxlNN0F4c0h3IP7Mk7/NqnXFjrYh3b2wq2H4UtRQHMECn2SDh3WNFyvPxb64U5EXzMki0cMtjbsVEWKFLnfCdkFCeTZXSmAVGp/SKtu2dl5EjrQ7yvE9e2b7Nh9LE8qVjHObbSnzv3AjsHj6PN9oF4PixxvcvPZMZuCt6lLF6GNfraYHA=
  - secure: 4TGb/w371vLpf0jvrWIoZtHEnYk6/2MBSiWyB++6IZ5wD/y78tkOA6nTmsZ5zveACXeHzkoO6j/SVV0vdgg7MIkkO0K5ZWwvb+AXV/k5TRI2HPQRnglnBKkrGGB8IZ6YqXG8aLAVMw7P4Tj88zAnvxgC0qYR+V9CIHqYFgKCnbLfGn9BLYXYiSX9f7MFPIMV6i47Owxvn2s1bdrb+94XMK1BMldRqg123ftJeW9tN6ufBj2lkhL3yw0RW1L45rUT6m1RAXpxdtoUqEq4c4aJWS7gKnjNcQg1jx6H0xRBbuAoMrfgiH0USvgYZJ8JuB4y0ez9p/3JNL5GZfmXrX56EkUcggO+0Q185UdApWLS0zLYkLEMuAwYk1FiRYQ3zRWUB15HVjyySpZJksrt1YWFR2/U0ABCkZNh4s0OXVfyzTLHaNcvk+t8CnNGzIGeI/apAF6EcV1sNat7rv+E/NaQwPmMjKWzVXwErvqQsYtWyFWV8/zOjwVQ5sWne1+C3MxNzB9J/FRhTlc1eAg203X45mPBV4BT5+737YlG9Ls/lmb54JO0Y19H7PZf9KSK5qVoGdzUTLGvISTYMsoJlv5cnSFLsy2PhPAsqFyaqxL8IMYAxUHob7ygQYrZ9IQLkcb8qfuFI7QUSQpKBBm2nM+d+sBeyNA1cBFO3/0INxs/nUk=
  - secure: olEZEtqkD7YxjQHfPxvw5YSPKmXIDwi9AwqSgQskyihNLTzxfNqg2YoJOc/eX45i9ziHm0wtuI9EkZGA4mzujIk/43vQaNmzNLyVRopyjW+/LNdxKWKMDeDeSbZ37tH4XmBiWgvNCuKzCZRiOVMAxCGeOz13MvjVDOSlEl7NInBxMvYsMMh9JZRxcVBRHJAfsevSG/I3GDgmcjqqz89uGhI8S8Y31zYUOdvKA2zbHq8JkdkHySVHBJJ6rR7VcbV3M3x1ArSjWtEPYMn3hWGKFsRLyy5Ua50wWz9VbCqUGlA8w+ChuP78GZ2r9XcbwujfFcg+JZT9JLPbAHmXbkkqbBMbQH9jb0bdM3PmoJFJkj8mI/WizinUwOg7U1e4or15w3eaMVXyU4x50991pZmreQ1lXqaPYZoadR4H4N+KsnDa2zcAVZGnTDVJcBxt9mksHukdjVxD6grKwRlSXXqGOYq9Wq/mZk7ZSDVA3nJLMZy8G9LDjLBOo6dQlo55OaEcJrAsDFBP0af40porfAamI1X99b2Kzs5rp/Q7pI3POEuQoUavxCC55/FSgjkL6jNp4LOsrYVgymymrPZ9p13JQilUK7JMPVq/F/mByPAdoEJbq8QG4p1DyPwwYfA7hygs8qpMXm3sBGhhjukOUQtZGFqs/c5ft4xGYNbwBGL30eo=

  # Staging Setting
  - secure: LicpJlyyyeKkNAdo1b9qQuFudAtenvej+4EkINRg7dm+YnMXq5CKe4eYh800eseveUMPo2DYnEf5dbAsk7LEHsx4qfCZ3aOl3SPGFiLqxbaZ09nbJdHZdN9IK4vtQpCY2Wzd0FiUq05D8nBPtE/ijI1HfVwpEUbI2jUHwIz8MSjazz9Wqq/QP/hKMiguEFLJSFd5Hme0OuLmxasW71qzXB4ENp2pRrd3l66uAz30QaslvOcjcZAyQ5LEWGtZAt04VO38xumk/6H4uKYnfGp0lB6bYXEI3CSDEzoS96GUrrwJj7E/ceTqTkq5tU4GI5qHs0OSWgAiNtowCy/2qWff/gMbvRxIuJdaoKMNyKssqa0GrABrB5Ql3+xBvG+2W+8nXveSPIBbZBAk3jsB9a0rw/RzOKuz5p0ciB453td8/UXkyEYMauyCJX1rHBDMyhd71OLSPM1IDm6tjjofRd2bKFMYL1Qr2ZbbLv3myXP/+oxvxcd6ay9W6niqOvphAk4TVsGMEoL0iCxjfMaxV1CJYcupq83J8TmlmDsNBCtAfzHuinMrUYWa/eDa9iedskqsZEgk/dg749YER4cc69E1t8dLvUkVhxIhz2RE/4/e3leCQLbTkkJZz1EOTBDvibBPq5tyOye2GgoNbgZvk/SEGtVoXO3T+CTgzKCMx8eCz6A=
  - secure: taL1wbjf4Jv8f00e4QH/WlOhTh4Kh0btfR2/MldU8SiJEgV1geU6TwB8TVVWnFRSFq/6wPXm2WNoofG1tGvSdBmgGps8xLPs2KO6Bo1nNzeZyuUH1+28iXiwbQKm/UnCYdD5oTNUQz5E/nANM6EZGQ8agmZAAwqCqd877FHqdpFPd2xCByyeHwI49eVj4gRbA19imD7UvEW2DeBi+s4kGPw90khp2pl8lXxK3gyUgqY/+ZvI74RDwab00JTDNi2lS/itqENZZWDGWgntmxWHCZlH+AKIEkM29atD4CNHbXCOp+GMGbrKJLvEMouHHDiFbTQ5YOmIf/iqwLUTmra0ScjGIrv5QQUML7uD5xCkozfRH8Kwh+8U7J8DmCFZP1fgUbZZ8jW9Nefhf+KKQIooSkLXJY0N++FAW+/A312VyXmxrIeViJJKGJfAex/HzR2BI1CtoFwbbLCnC+Tkr73cPQrTnnv4pm2tPFBjFXt+J1kbHyCKhxcrf1FJrNInxxBbM9cFjFs3NvACY2V5triDMUamlKaG+xu9uCJQTbhvjQ667SkhCXu4YRadW9nIxxX2sHA8CDLsBpJzn+iaLoCZn6blvI5/TwCCDq8Ds2ioYnSYqSxpOjtdNsTA0PKMmc97fFuaEsU/XXCc4Yy1cGxMG3AXhx3nJ9egCbsB32SPcTw=
  - secure: kJV7rIKLAJAKWYdDdtjRILSSq5AOUARFJ25DZUKvE6VzIdoH3gOmSUEBoOo9gtMyUqK8sofsLpC6jUYKuiCNl9F6lXXZ37ZTOj+yjYh+OUscbs+r+Fv/L3DqIKNbsUN1X0Ru8JWxtUADyEldVjn1qhGxVN8+NTxSQn6G4XKvDsKa1oAkHHaZtX9u4l+InBwwWe0Nf0LzHq3I2GxMm0o4zI+uLIxpkNbPzmrWGvLGG+4H4F5kqhEFkIKoNefilXug41gUKB/VqSApN7lu6kFAbF+MkEKxIu3+pe+hZLr5gkIhPuhR0BI3j8dTFMtbW90enRRt7T5fntcM8ypqrQAsXGoUQOz8EcqgkRKmIeiqEQgGuuYR4pnMlSrzYhcqJLqCCuAN4ldehzb/6asQknnY1kG1YF8HK9BETsddsjHkFbnuOLZ3peRCDJ2WjmzqeAJzFWVHgmKTk+oc0Nl5v8rT1KqLft4Cs+Y0bnnuwjbZUMS8EFWOLiNZG8UZGySYGcCZKcD+dxveTC/ywSWfCSfU6qzKkmNQ95V7Np+F8E9NXNCIY9sJGqH32JhoHgV76W3pKZ/DtUl0HJZMCOAdu4kuBAzDZkSAff62ropubuFKFE3HgZj0ZcztaHK/gbVBElDhpDtzb6lim9a4ZYsVrUcM+J1Iv7QC4mPYwLbzYVoB5EI=

  # Production Setting
  - secure: LicpJlyyyeKkNAdo1b9qQuFudAtenvej+4EkINRg7dm+YnMXq5CKe4eYh800eseveUMPo2DYnEf5dbAsk7LEHsx4qfCZ3aOl3SPGFiLqxbaZ09nbJdHZdN9IK4vtQpCY2Wzd0FiUq05D8nBPtE/ijI1HfVwpEUbI2jUHwIz8MSjazz9Wqq/QP/hKMiguEFLJSFd5Hme0OuLmxasW71qzXB4ENp2pRrd3l66uAz30QaslvOcjcZAyQ5LEWGtZAt04VO38xumk/6H4uKYnfGp0lB6bYXEI3CSDEzoS96GUrrwJj7E/ceTqTkq5tU4GI5qHs0OSWgAiNtowCy/2qWff/gMbvRxIuJdaoKMNyKssqa0GrABrB5Ql3+xBvG+2W+8nXveSPIBbZBAk3jsB9a0rw/RzOKuz5p0ciB453td8/UXkyEYMauyCJX1rHBDMyhd71OLSPM1IDm6tjjofRd2bKFMYL1Qr2ZbbLv3myXP/+oxvxcd6ay9W6niqOvphAk4TVsGMEoL0iCxjfMaxV1CJYcupq83J8TmlmDsNBCtAfzHuinMrUYWa/eDa9iedskqsZEgk/dg749YER4cc69E1t8dLvUkVhxIhz2RE/4/e3leCQLbTkkJZz1EOTBDvibBPq5tyOye2GgoNbgZvk/SEGtVoXO3T+CTgzKCMx8eCz6A=
  - secure: taL1wbjf4Jv8f00e4QH/WlOhTh4Kh0btfR2/MldU8SiJEgV1geU6TwB8TVVWnFRSFq/6wPXm2WNoofG1tGvSdBmgGps8xLPs2KO6Bo1nNzeZyuUH1+28iXiwbQKm/UnCYdD5oTNUQz5E/nANM6EZGQ8agmZAAwqCqd877FHqdpFPd2xCByyeHwI49eVj4gRbA19imD7UvEW2DeBi+s4kGPw90khp2pl8lXxK3gyUgqY/+ZvI74RDwab00JTDNi2lS/itqENZZWDGWgntmxWHCZlH+AKIEkM29atD4CNHbXCOp+GMGbrKJLvEMouHHDiFbTQ5YOmIf/iqwLUTmra0ScjGIrv5QQUML7uD5xCkozfRH8Kwh+8U7J8DmCFZP1fgUbZZ8jW9Nefhf+KKQIooSkLXJY0N++FAW+/A312VyXmxrIeViJJKGJfAex/HzR2BI1CtoFwbbLCnC+Tkr73cPQrTnnv4pm2tPFBjFXt+J1kbHyCKhxcrf1FJrNInxxBbM9cFjFs3NvACY2V5triDMUamlKaG+xu9uCJQTbhvjQ667SkhCXu4YRadW9nIxxX2sHA8CDLsBpJzn+iaLoCZn6blvI5/TwCCDq8Ds2ioYnSYqSxpOjtdNsTA0PKMmc97fFuaEsU/XXCc4Yy1cGxMG3AXhx3nJ9egCbsB32SPcTw=
  - secure: kJV7rIKLAJAKWYdDdtjRILSSq5AOUARFJ25DZUKvE6VzIdoH3gOmSUEBoOo9gtMyUqK8sofsLpC6jUYKuiCNl9F6lXXZ37ZTOj+yjYh+OUscbs+r+Fv/L3DqIKNbsUN1X0Ru8JWxtUADyEldVjn1qhGxVN8+NTxSQn6G4XKvDsKa1oAkHHaZtX9u4l+InBwwWe0Nf0LzHq3I2GxMm0o4zI+uLIxpkNbPzmrWGvLGG+4H4F5kqhEFkIKoNefilXug41gUKB/VqSApN7lu6kFAbF+MkEKxIu3+pe+hZLr5gkIhPuhR0BI3j8dTFMtbW90enRRt7T5fntcM8ypqrQAsXGoUQOz8EcqgkRKmIeiqEQgGuuYR4pnMlSrzYhcqJLqCCuAN4ldehzb/6asQknnY1kG1YF8HK9BETsddsjHkFbnuOLZ3peRCDJ2WjmzqeAJzFWVHgmKTk+oc0Nl5v8rT1KqLft4Cs+Y0bnnuwjbZUMS8EFWOLiNZG8UZGySYGcCZKcD+dxveTC/ywSWfCSfU6qzKkmNQ95V7Np+F8E9NXNCIY9sJGqH32JhoHgV76W3pKZ/DtUl0HJZMCOAdu4kuBAzDZkSAff62ropubuFKFE3HgZj0ZcztaHK/gbVBElDhpDtzb6lim9a4ZYsVrUcM+J1Iv7QC4mPYwLbzYVoB5EI=

install:
- make global-python-package-install-development

before_script:
- make settings
- mysql -u root -e "use mysql; UPDATE user SET password=password('root') WHERE user='root'; flush privileges;"

script:
- make lint
- make test
- make check-deprecated

before_deploy:
- pip3 install docker-compose
- apk update && apk add curl
- curl -o /usr/local/bin/ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-v1.7.0
- chmod +x /usr/local/bin/ecs-cli

deploy:
  # Deploy development
  - provider: script
    script: bash docs/scripts/deploy.sh development
#    on:
#      branch: master

# Deploy staging
# - provider: script
#  script: bash docs/scripts/deploy.sh staging
#  on:
#    branch: master

# Deploy production
#  - provider: script
#    script: bash docs/scripts/deploy.sh production
#    on:
#      tags: true
